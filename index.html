
<!DOCTYPE html>
<html lang="pt">
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Mural com GitHub</title></head>
<body>
  <h1>Mural com GitHub</h1>
  <div id="githubPanel">
    <input id="usuario" placeholder="Utilizador GitHub"><br>
    <input id="repositorio" placeholder="Repositório"><br>
    <input id="ficheiro" value="noticias.json"><br>
    <input id="token" type="password" placeholder="Token GitHub"><br>
    <button onclick="guardar()">Guardar no GitHub</button>
    <p id="msg"></p>
    <pre id="jsonOut"></pre>
  </div>
  <script>
    let noticias = [];
    async function guardar() {
      const msg = document.getElementById("msg");
      const username = usuario.value;
      const repo = repositorio.value;
      const path = ficheiro.value;
      const token = token.value;
      const url = `https://api.github.com/repos/${username}/${repo}/contents/${path}`;
      const content = btoa(unescape(encodeURIComponent(JSON.stringify(noticias, null, 2))));
      try {
        const resp = await fetch(url, { headers: { Authorization: "token " + token }});
        const sha = (await resp.json()).sha;
        const save = await fetch(url, {
          method: "PUT",
          headers: { Authorization: "token " + token, "Content-Type": "application/json" },
          body: JSON.stringify({ message: "Update", content, sha })
        });
        msg.textContent = save.ok ? "✅ Guardado com sucesso!" : "❌ Erro ao guardar.";
      } catch (e) {
        msg.textContent = "❌ Erro de rede/API.";
      }
    }
  </script>
</body>
</html>
